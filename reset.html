<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Reset Password â€” Calculator Gaji HASA UiTM</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script src="firebase-config.js"></script>
<script src="auth.js"></script>

<style>
    /* ===== VARIABLES & RESET ===== */
    :root {
        --primary-grad: linear-gradient(135deg, #FF6B6B 0%, #5E2A84 100%);
        --text-dark: #1f2937;
        --text-muted: #6b7280;
        --glass-bg: rgba(255, 255, 255, 0.75);
        --glass-border: rgba(255, 255, 255, 0.6);
        --radius: 16px;
        --success: #10b981;
        --error: #ef4444;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
        font-family: 'Inter', sans-serif;
        background: #f3f0ff;
        color: var(--text-dark);
        
        /* FIX SCREEN - NO SCROLL ON BODY */
        height: 100vh;
        width: 100vw;
        overflow: hidden; 
        
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        position: relative;
    }

    /* ===== FLOATING BLOBS ===== */
    .blob {
        position: absolute;
        border-radius: 50%;
        filter: blur(80px);
        opacity: 0.6;
        z-index: -1;
        animation: float 10s ease-in-out infinite;
        pointer-events: none;
    }
    .blob1 { width: 400px; height: 400px; background: #FF6B6B; top: -100px; left: -100px; animation-delay: 0s; }
    .blob2 { width: 350px; height: 350px; background: #5E2A84; bottom: -50px; right: -50px; animation-delay: 2s; }
    .blob3 { width: 300px; height: 300px; background: #A445B2; top: 40%; left: 50%; transform: translate(-50%, -50%); opacity: 0.4; animation-delay: 4s; }

    @keyframes float {
        0%, 100% { transform: translate(0, 0); }
        50% { transform: translate(20px, -20px); }
    }

    /* ===== BACK BUTTON ===== */
    .back-nav-float {
        position: absolute;
        top: 25px; left: 25px; z-index: 100;
        display: flex; align-items: center; gap: 10px;
        background: rgba(255, 255, 255, 0.6);
        backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
        padding: 10px 20px; border-radius: 30px;
        border: 1px solid rgba(255, 255, 255, 0.4);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        text-decoration: none; color: #5E2A84;
        font-weight: 600; font-size: 0.9rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .back-nav-float:hover { background: white; transform: translateY(-2px); box-shadow: 0 8px 20px rgba(94, 42, 132, 0.15); color: #4c1d6e; }
    .back-nav-float svg { width: 20px; height: 20px; transition: transform 0.3s ease; }
    
    @media (max-width: 768px) {
        .back-nav-float { top: 20px; left: 20px; padding: 0; width: 44px; height: 44px; border-radius: 50%; justify-content: center; gap: 0; }
        .back-nav-float span { display: none; }
    }

    /* ===== MAIN WRAPPER ===== */
    .main-wrapper {
        width: 100%; max-width: 440px; padding: 20px; z-index: 10;
        text-align: center;
        
        /* INTERNAL SCROLL IF NEEDED */
        max-height: 100vh;
        overflow-y: auto;
        scrollbar-width: none;
    }
    .main-wrapper::-webkit-scrollbar { display: none; }

    .card {
        background: var(--glass-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border); border-radius: var(--radius);
        padding: 40px 30px; 
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0,0,0,0.1);
        text-align: center;
    }

    /* Icon Lock */
    .icon-wrapper {
        width: 60px; height: 60px; background: rgba(255, 255, 255, 0.8);
        border-radius: 50%; display: flex; align-items: center; justify-content: center;
        margin: 0 auto 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); color: #5E2A84;
    }

    h2 {
        font-family: 'Poppins', sans-serif; font-size: 1.6rem; font-weight: 700; margin-bottom: 10px;
        background: var(--primary-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }

    p.subtitle { color: var(--text-muted); font-size: 0.95rem; margin-bottom: 30px; line-height: 1.5; }

    .input-group { margin-bottom: 20px; text-align: left; }
    .input-label { display: block; font-size: 0.85rem; font-weight: 600; color: var(--text-dark); margin-bottom: 8px; margin-left: 4px; }

    .input {
        width: 100%; padding: 14px 16px; border: 1px solid #e5e7eb; border-radius: 10px;
        font-size: 0.95rem; background: rgba(255,255,255,0.9); font-family: 'Inter', sans-serif;
    }
    .input:focus { outline: none; border-color: #5E2A84; box-shadow: 0 0 0 4px rgba(94, 42, 132, 0.1); }

    .btn {
        width: 100%; padding: 14px; border: none; border-radius: 10px;
        font-weight: 600; font-size: 1rem; cursor: pointer;
        display: flex; justify-content: center; align-items: center; gap: 10px;
        font-family: 'Inter', sans-serif; background: var(--primary-grad); color: white;
        box-shadow: 0 10px 20px -5px rgba(94, 42, 132, 0.3);
    }
    .btn:active { transform: scale(0.98); }
    .btn:disabled { opacity: 0.7; cursor: not-allowed; }

    /* Messages */
    #resetMsg { margin-top: 20px; font-size: 0.9rem; border-radius: 8px; padding: 12px; display: none; text-align: left; }
    .msg-success { background: rgba(16, 185, 129, 0.1); color: #047857; border: 1px solid rgba(16, 185, 129, 0.2); }
    .msg-error { background: rgba(239, 68, 68, 0.1); color: #b91c1c; border: 1px solid rgba(239, 68, 68, 0.2); }

    /* Animation */
    .fade-in { animation: fadeIn 0.5s ease-out forwards; opacity: 0; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .spinner {
        width: 18px; height: 18px; border: 2px solid #fff; border-bottom-color: transparent;
        border-radius: 50%; display: none; animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>

<body>

  <div class="blob blob1"></div>
  <div class="blob blob2"></div>
  <div class="blob blob3"></div>

  <a href="login.html" class="back-nav-float">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
      </svg>
      <span>Kembali ke Login</span>
  </a>

  <div class="main-wrapper fade-in">
    <div class="card">
        
        <div class="icon-wrapper">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
        </div>

        <h2>Lupa Kata Laluan?</h2>
        <p class="subtitle">Jangan risau. Masukkan email anda di bawah dan kami akan hantar arahan reset.</p>

        <div class="input-group">
            <label for="email" class="input-label">Email Pengguna</label>
            <input type="email" id="email" class="input" placeholder="contoh@email.com">
        </div>

        <button id="sendReset" class="btn">
            <span class="spinner" id="btnSpinner"></span>
            <span id="btnText">Hantar Email Reset</span>
        </button>

        <div id="resetMsg"></div>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    
    // UI Elements
    const sendBtn = document.getElementById('sendReset');
    const emailInput = document.getElementById('email');
    const msgBox = document.getElementById('resetMsg');
    const btnSpinner = document.getElementById('btnSpinner');
    const btnText = document.getElementById('btnText');

    // Handle Reset Logic
    sendBtn.addEventListener('click', async () => {
        const email = emailInput.value.trim();
        
        // Reset UI Messages
        msgBox.style.display = 'none';
        msgBox.className = '';
        msgBox.textContent = '';

        if (!email) {
            showMsg('Sila masukkan email anda.', 'error');
            return;
        }

        setLoading(true);

        try {
            await resetPassword(email); // Function from auth.js
            showMsg('Pautan reset telah dihantar ke email anda. Sila periksa inbox atau spam.', 'success');
            emailInput.value = ''; // Clear input
        } catch (err) {
            console.error(err);
            let errorText = err.message;
            if(err.code === 'auth/user-not-found') errorText = "Email ini tidak berdaftar.";
            if(err.code === 'auth/invalid-email') errorText = "Format email tidak sah.";
            
            showMsg(errorText, 'error');
        } finally {
            setLoading(false);
        }
    });

    // Helper: Loading State
    function setLoading(isLoading) {
        sendBtn.disabled = isLoading;
        if (isLoading) {
            btnSpinner.style.display = 'inline-block';
            btnText.textContent = 'Menghantar...';
        } else {
            btnSpinner.style.display = 'none';
            btnText.textContent = 'Hantar Email Reset';
        }
    }

    // Helper: Show Message
    function showMsg(text, type) {
        msgBox.textContent = text;
        msgBox.className = type === 'success' ? 'msg-success' : 'msg-error';
        msgBox.style.display = 'block';
    }

    // Interactive Blob Mouse Follow
    const blobs = document.querySelectorAll('.blob');
    document.addEventListener('mousemove', (e) => {
        const x = (e.clientX / window.innerWidth) * 20;
        const y = (e.clientY / window.innerHeight) * 20;
        
        blobs.forEach((blob, index) => {
            const speed = (index + 1) * 2;
            blob.style.transform = `translate(${x * speed}px, ${y * speed}px)`;
        });
    });
});
</script>
</body>
</html>
