<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Login ‚Äî Calculator Gaji HASA UiTM</title>

<link rel="stylesheet" href="style.css">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script src="firebase-config.js"></script>
<script src="auth.js"></script>

<style>
/* ===== LOGIN PAGE SPECIFIC ===== */
html, body {overflow-x:hidden;}
body.login-page {
  background:#f0e6ff;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  position:relative;
  font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

/* ===== FLOATING BLOBS ===== */
.blob {position:absolute; border-radius:50%; filter:blur(120px); opacity:0.9; z-index:0; pointer-events:none; max-width:100vw; max-height:100vh; transition: transform 0.1s;}
.blob1 {width:350px; height:350px; background:linear-gradient(135deg,#FF6B6B,#5E2A84); top:-100px; left:-80px;}
.blob2 {width:400px; height:400px; background:linear-gradient(135deg,#A445B2,#FFB2E6); bottom:-120px; right:-100px;}
.blob3 {width:300px; height:300px; background:linear-gradient(135deg,#FF9F1C,#FF6B6B); top:30%; right:20%;}

/* ===== CARD ===== */
.container {position:relative; z-index:2; text-align:center;}
.card {
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(18px);
  border-radius:25px;
  padding:40px 30px;
  box-shadow:0 12px 30px rgba(0,0,0,0.2);
  max-width:400px;
  margin:auto;
  position:relative;
  text-align:center;
}
.input {width:100%; padding:12px 16px; margin-bottom:15px; border-radius:10px; border:1px solid #ccc;}
.password-wrap {position:relative;}
.show-pass-btn {position:absolute; top:35%; right:10px; transform:translateY(-50%); border:none; background:none; cursor:pointer; font-size:16px; color:#5E2A84;}
.btn {width:100%; padding:12px 0; margin-bottom:12px; border:none; border-radius:50px; font-weight:700; cursor:pointer; font-size:1rem; box-shadow:0 6px 20px rgba(0,0,0,0.2);}
.btn-primary {background:linear-gradient(45deg,#FF6B6B,#5E2A84); color:white; transition:0.3s;}
.btn-primary:hover {transform:scale(1.05);}
.btn-outline {background:rgba(255,255,255,0.2); color:#2C1E3A; border:2px solid #5E2A84;}
.btn-outline:hover {background:#5E2A84; color:white; transform:scale(1.05);}
.small {font-size:0.85rem; display:block; margin-top:10px; color:#3C2A50; text-decoration:none;}

/* ===== LOGIN TITLE ===== */
.login-title {font-size:1.8rem; color:#2C1E3A; margin-bottom:10px;}
.login-subtitle {color:#3C2A50; margin-bottom:25px;}

/* Accessibility & small UI helpers */
.visually-hidden {position: absolute !important; height: 1px; width: 1px; overflow: hidden; clip: rect(1px, 1px, 1px, 1px); white-space: nowrap;}

.input:focus {outline: 3px solid rgba(90,40,120,0.18); box-shadow: 0 4px 20px rgba(94,42,132,0.12);}
.btn:disabled {opacity:0.6; cursor:not-allowed; transform:none}
.show-pass-btn {background:none; border:0; padding:6px; border-radius:8px}
.show-pass-btn:focus {outline:2px solid rgba(94,42,132,0.25)}

/* spinner inside buttons */
.spinner {display:inline-block; width:14px; height:14px; margin-left:8px; border-radius:50%; border:2px solid rgba(255,255,255,0.6); border-right-color:transparent; vertical-align:middle; animation:spin 0.8s linear infinite; opacity:0}
.btn.loading .spinner {opacity:1}
@keyframes spin {to {transform:rotate(360deg)}}

/* Fade-in class used by script */
.fade-in {animation:fadeIn 360ms ease both}
@keyframes fadeIn {from {opacity:0; transform:translateY(6px)} to {opacity:1; transform:none}}

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce) {
  .spinner, .blob {animation: none !important; transition: none !important}
}
</style>
</head>

<body class="login-page">

<!-- FLOATING BLOBS -->
<div class="blob blob1"></div>
<div class="blob blob2"></div>
<div class="blob blob3"></div>

<!-- ===== LOGIN TITLE ===== -->
<h1 class="login-title v2">Selamat Datang Ke Calculator Gaji HASA</h1>
<p class="login-subtitle v2">Selamat datang ke sistem Calculator Gaji ‚Äî mudah, pantas & mesra pengguna!</p>


<a href="index.html" class="back-btn">‚Üê Kembali ke Laman Utama</a>


<div class="container">
  <div class="card">

    <h2>Log Masuk</h2>

    <form id="loginForm" novalidate>
      <label for="email" class="visually-hidden">Email</label>
      <input id="email" class="input" type="email" placeholder="Email" required autocomplete="email" autofocus>

      <div class="password-wrap">
        <label for="password" class="visually-hidden">Kata Laluan</label>
        <input id="password" class="input" type="password" placeholder="Kata Laluan" required autocomplete="current-password">
        <button type="button" class="show-pass-btn" id="showPassBtn" aria-pressed="false" aria-label="Tunjukkan kata laluan">üëÅ</button>
      </div>

      <button id="loginBtn" type="submit" class="btn btn-primary">Login <span id="loginSpinner" class="spinner" aria-hidden="true"></span></button>
      <a href="signup.html" class="btn btn-outline" role="button">Sign Up</a>
      <button id="googleBtn" type="button" class="btn btn-outline google-btn" aria-label="Log masuk dengan Google">Login with Google</button>
      <a href="reset.html" class="small">Lupa kata laluan?</a>

      <div id="loginMsg" role="status" aria-live="polite"></div>
    </form>
  </div>
</div>

<script>
// ===== LOGIN FUNCTIONALITY =====
(() => {
  const form = document.getElementById('loginForm');
  const emailEl = document.getElementById('email');
  const passInput = document.getElementById('password');
  const loginBtn = document.getElementById('loginBtn');
  const googleBtn = document.getElementById('googleBtn');
  const loginMsg = document.getElementById('loginMsg');
  const showBtn = document.getElementById('showPassBtn');
  const spinner = document.getElementById('loginSpinner');

  function setMessage(text, color) {
    loginMsg.textContent = text || '';
    loginMsg.style.color = color || '';
  }

  function setLoading(isLoading) {
    if (isLoading) {
      loginBtn.setAttribute('disabled', '');
      loginBtn.classList.add('loading');
      spinner.style.opacity = '1';
    } else {
      loginBtn.removeAttribute('disabled');
      loginBtn.classList.remove('loading');
      spinner.style.opacity = '0';
    }
  }

  // Form submit (supports Enter key)
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    setMessage('', '');

    const email = emailEl.value.trim();
    const password = passInput.value;

    if (!email || !password) {
      setMessage('Sila isi email dan kata laluan.', 'red');
      return;
    }

    setLoading(true);
    try {
      await loginUser(email, password);
      setMessage('Login berjaya. Sila tunggu...', 'green');
      setTimeout(() => window.location.href = 'dashboard.html', 500);
    } catch (err) {
      setMessage(err && err.message ? err.message : 'Ralat log masuk.', 'red');
    } finally {
      setLoading(false);
    }
  });

  // Google login
  googleBtn.addEventListener('click', async () => {
    setMessage('', '');
    googleBtn.setAttribute('disabled', '');
    try {
      await loginWithGoogle();
      window.location.href = 'dashboard.html';
    } catch (err) {
      setMessage(err && err.message ? err.message : 'Gagal login Google.', 'red');
    } finally {
      googleBtn.removeAttribute('disabled');
    }
  });

  // Show/hide password: support toggle on click, hold on press, and keyboard
  let holdTimeout = null;
  function showPassword() { passInput.type = 'text'; showBtn.setAttribute('aria-pressed', 'true'); }
  function hidePassword() { passInput.type = 'password'; showBtn.setAttribute('aria-pressed', 'false'); }

  // mouse / touch hold
  showBtn.addEventListener('mousedown', ()=>{ showPassword(); });
  showBtn.addEventListener('mouseup', ()=>{ hidePassword(); });
  showBtn.addEventListener('mouseleave', ()=>{ hidePassword(); });
  showBtn.addEventListener('touchstart', ()=>{ showPassword(); });
  showBtn.addEventListener('touchend', ()=>{ hidePassword(); });

  // click toggles (useful for keyboard and screen readers)
  showBtn.addEventListener('click', (e) => {
    // if it's a quick click, toggle state
    if (passInput.type === 'password') showPassword(); else hidePassword();
  });

  showBtn.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); showBtn.click(); }
  });

  // ===== SCROLL TO TOP ON LOAD =====
  window.addEventListener('load', () => { window.scrollTo({ top: 0, behavior: 'auto' }); });

  // ===== INTERACTIVE BLOB MOUSE FOLLOW =====
  const blobs = document.querySelectorAll('.blob');
  document.addEventListener('mousemove', e=>{
    blobs.forEach((b,i)=>{
      const speed = (i+1)*0.02;
      const x = (e.clientX - window.innerWidth/2)*speed;
      const y = (e.clientY - window.innerHeight/2)*speed;
      b.style.transform = `translate(${x}px, ${y}px)`;
    });
  });

  document.addEventListener('DOMContentLoaded', function() {
      // Fade in page
      document.body.classList.add('fade-in');

      // Semua link dashboard-nav (if present)
      const links = document.querySelectorAll('.dashboard-nav .nav-link');

      links.forEach(link => {
          link.addEventListener('click', function(e) {
              e.preventDefault(); // prevent immediate redirect

              const href = this.getAttribute('href');

              // Fade out
              document.body.style.opacity = 0;

              setTimeout(() => {
                  window.location.href = href; // redirect selepas fade out
              }, 400); // 400ms sama dengan transition
          });
      });
  });

})();
</script>

</body>
</html>
