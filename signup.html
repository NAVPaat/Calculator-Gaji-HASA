<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Sign Up â€” Calculator Gaji HASA UiTM</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script src="firebase-config.js"></script>
<script src="auth.js"></script>

<style>
    /* ===== VARIABLES & RESET ===== */
    :root {
        --primary-grad: linear-gradient(135deg, #FF6B6B 0%, #5E2A84 100%);
        --text-dark: #1f2937;
        --text-muted: #6b7280;
        --glass-bg: rgba(255, 255, 255, 0.75);
        --glass-border: rgba(255, 255, 255, 0.6);
        --radius: 16px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
        font-family: 'Inter', sans-serif;
        background: #f3f0ff;
        color: var(--text-dark);
        
        /* FIX SCREEN - NO SCROLL ON BODY */
        height: 100vh;
        width: 100vw;
        overflow: hidden; 
        
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        position: relative;
    }

    /* ===== FLOATING BLOBS ===== */
    .blob {
        position: absolute;
        border-radius: 50%;
        filter: blur(80px);
        opacity: 0.6;
        z-index: -1;
        animation: float 10s ease-in-out infinite;
        pointer-events: none;
    }
    .blob1 { width: 400px; height: 400px; background: #FF6B6B; top: -100px; left: -100px; animation-delay: 0s; }
    .blob2 { width: 350px; height: 350px; background: #5E2A84; bottom: -50px; right: -50px; animation-delay: 2s; }
    .blob3 { width: 300px; height: 300px; background: #A445B2; top: 40%; left: 50%; transform: translate(-50%, -50%); opacity: 0.4; animation-delay: 4s; }

    @keyframes float {
        0%, 100% { transform: translate(0, 0); }
        50% { transform: translate(20px, -20px); }
    }

    /* ===== BACK BUTTON ===== */
    .back-nav-float {
        position: absolute;
        top: 25px; left: 25px; z-index: 100;
        display: flex; align-items: center; gap: 10px;
        background: rgba(255, 255, 255, 0.6);
        backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
        padding: 10px 20px; border-radius: 30px;
        border: 1px solid rgba(255, 255, 255, 0.4);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        text-decoration: none; color: #5E2A84;
        font-weight: 600; font-size: 0.9rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .back-nav-float:hover { background: white; transform: translateY(-2px); box-shadow: 0 8px 20px rgba(94, 42, 132, 0.15); color: #4c1d6e; }
    .back-nav-float svg { width: 20px; height: 20px; transition: transform 0.3s ease; }
    
    @media (max-width: 768px) {
        .back-nav-float { top: 20px; left: 20px; padding: 0; width: 44px; height: 44px; border-radius: 50%; justify-content: center; gap: 0; }
        .back-nav-float span { display: none; }
    }

    /* ===== MAIN WRAPPER ===== */
    .main-wrapper {
        width: 100%; max-width: 440px; padding: 20px; z-index: 10;
        
        /* INTERAL SCROLL ONLY IF NEEDED (Clean UI) */
        max-height: 100vh;
        overflow-y: auto;
        scrollbar-width: none;
    }
    .main-wrapper::-webkit-scrollbar { display: none; }

    .card {
        background: var(--glass-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border); border-radius: var(--radius);
        padding: 30px; 
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0,0,0,0.1);
        text-align: left;
    }

    .card h2 {
        font-family: 'Poppins', sans-serif; font-size: 1.6rem; font-weight: 700; margin-bottom: 5px;
        background: var(--primary-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        text-align: center;
    }
    .card p.subtitle { text-align: center; color: var(--text-muted); margin-bottom: 20px; font-size: 0.9rem; }

    /* ===== FORM ===== */
    .input-group { margin-bottom: 12px; position: relative; }
    
    .input {
        width: 100%; padding: 12px 16px; border: 1px solid #e5e7eb; border-radius: 10px;
        font-size: 0.95rem; background: rgba(255,255,255,0.9);
        font-family: 'Inter', sans-serif; color: var(--text-dark);
    }
    .input:focus { outline: none; border-color: #5E2A84; box-shadow: 0 0 0 4px rgba(94, 42, 132, 0.1); }
    
    /* CUSTOM SELECT & ARROW STYLING */
    .select-wrapper {
        position: relative;
        width: 100%;
    }

    select.input { 
        appearance: none; -webkit-appearance: none; -moz-appearance: none; 
        cursor: pointer; 
        padding-right: 40px; /* Space for arrow */
    }

    /* The Animated Arrow */
    .custom-arrow {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%); /* Centered vertically, Default Left (As drawn) */
        pointer-events: none; /* Let click pass through */
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); /* Smooth animation */
        width: 20px;
        height: 20px;
        color: #6b7280;
    }

    /* When active (Class added via JS) */
    .select-wrapper.active .custom-arrow {
        transform: translateY(-50%) rotate(-90deg); /* Rotate Left to Down */
        color: #5E2A84; /* Change color when active */
    }

    /* Button */
    .btn {
        width: 100%; padding: 12px; border: none; border-radius: 10px;
        font-weight: 600; font-size: 1rem; cursor: pointer;
        display: flex; justify-content: center; align-items: center; gap: 10px;
        font-family: 'Inter', sans-serif; background: var(--primary-grad); color: white;
        box-shadow: 0 10px 20px -5px rgba(94, 42, 132, 0.3); margin-top: 15px;
    }
    .btn:active { transform: scale(0.98); }
    
    .link-center { text-align: center; margin-top: 15px; display: block; color: #5E2A84; text-decoration: none; font-size: 0.9rem; }
    .link-center b { font-weight: 600; }

    #signupMsg { margin-top: 10px; font-size: 0.85rem; text-align: center; min-height: 20px; }
    
    .fade-in { animation: fadeIn 0.5s ease-out forwards; opacity: 0; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .spinner {
        width: 18px; height: 18px; border: 2px solid #fff; border-bottom-color: transparent;
        border-radius: 50%; display: none; animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>

<body>

    <div class="blob blob1"></div>
    <div class="blob blob2"></div>
    <div class="blob blob3"></div>

    <a href="login.html" class="back-nav-float">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        <span>Kembali ke Login</span>
    </a>

    <div class="main-wrapper fade-in">
        <div class="card">
            <h2>Daftar Akaun</h2>
            <p class="subtitle">Isi maklumat di bawah.</p>

            <form onsubmit="event.preventDefault();"> 
                
                <div class="input-group">
                    <input id="fullname" class="input" type="text" placeholder="NAMA PENUH" required>
                </div>

                <div class="input-group">
                    <input id="email" class="input" type="email" placeholder="Email" required>
                </div>

                <div class="input-group">
                    <input id="phone" class="input" type="tel" placeholder="No Telefon" required>
                </div>

                <div class="input-group select-wrapper" id="genderWrapper">
                    <select id="gender" class="input" required>
                        <option value="" disabled selected>Pilih Jantina</option>
                        <option value="lelaki">Lelaki</option>
                        <option value="perempuan">Perempuan</option>
                    </select>
                    <svg xmlns="http://www.w3.org/2000/svg" class="custom-arrow" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                    </svg>
                </div>

                <div class="input-group">
                    <input id="password" class="input" type="text" placeholder="Kata Laluan" required>
                </div>

                <button id="signupBtn" class="btn btn-primary">
                    <span>Daftar Akaun</span>
                    <span id="btnSpinner" class="spinner"></span>
                </button>

                <div id="signupMsg"></div>

                <a href="login.html" class="link-center">Sudah ada akaun? <b>Log Masuk</b></a>
            </form>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function() {

    // ===== VARIABLES =====
    const signupBtn = document.getElementById('signupBtn');
    const msg = document.getElementById('signupMsg');
    const passInput = document.getElementById('password');
    const nameInput = document.getElementById('fullname');
    const btnSpinner = document.getElementById('btnSpinner');

    // ===== GENDER ARROW ANIMATION LOGIC =====
    const genderSelect = document.getElementById('gender');
    const genderWrapper = document.getElementById('genderWrapper');

    // Bila user tekan/focus -> Rotate arrow ke Bawah
    genderSelect.addEventListener('focus', () => {
        genderWrapper.classList.add('active');
    });

    // Bila user click (untuk support mouse click)
    genderSelect.addEventListener('click', () => {
        // Toggle untuk UX mouse yang lebih baik
        // (kadang-kadang focus event dah trigger, tapi safety check)
        genderWrapper.classList.add('active'); 
    });

    // Bila user pilih item atau click luar (blur) -> Reset arrow ke Kiri
    genderSelect.addEventListener('change', () => {
        genderWrapper.classList.remove('active');
        genderSelect.blur(); // Remove focus lepas pilih supaya arrow reset
    });

    genderSelect.addEventListener('blur', () => {
        genderWrapper.classList.remove('active');
    });

    // ===== AUTO UPPERCASE NAME =====
    nameInput.addEventListener('input', function() {
        this.value = this.value.toUpperCase();
    });

    // ===== HELPER FUNCTIONS =====
    function setLoading(isLoading) {
        signupBtn.disabled = isLoading;
        btnSpinner.style.display = isLoading ? 'inline-block' : 'none';
    }

    function setMessage(text, color) {
        msg.textContent = text;
        msg.style.color = color;
    }

    // ===== SIGNUP LOGIC =====
    signupBtn.addEventListener('click', async () => {
        const name   = nameInput.value.trim().toUpperCase();
        const email  = document.getElementById('email').value.trim();
        const phone  = document.getElementById('phone').value.trim();
        const pwd    = passInput.value;
        const gender = document.getElementById('gender').value;

        setMessage('', '');

        // Validation
        if (!name || !email || !phone || !pwd || !gender) {
            setMessage('Sila lengkapkan semua ruangan.', '#ef4444'); 
            return;
        }
        if (pwd.length < 6) {
            setMessage('Kata laluan mesti sekurang-kurangnya 6 aksara.', '#ef4444'); 
            return;
        }

        // Determine Role
        let role = 'pengguna';
        if(email.endsWith('@uitm.edu.my')) role = 'pentadbir';

        setLoading(true);

        try {
            // MENGGUNAKAN FUNGSI DARI AUTH.JS ANDA
            await signupUser(name, email, phone, pwd, role, gender);

            // LOG OUT DAN SURUH LOGIN SEMULA
            await firebase.auth().signOut();

            setMessage('Pendaftaran berjaya! Sila log masuk semula...', '#10b981'); 
            
            setTimeout(() => {
                location.href = 'login.html';
            }, 1500);

        } catch(err) {
            console.error(err);
            let errorMsg = err.message;
            if(err.code === 'auth/email-already-in-use') errorMsg = "Email ini telah didaftarkan.";
            if(err.code === 'auth/weak-password') errorMsg = "Kata laluan terlalu lemah.";
            
            setMessage(errorMsg, '#ef4444');
        } finally {
            setLoading(false);
        }
    });

    // ===== BLOB ANIMATION =====
    const blobs = document.querySelectorAll('.blob');
    document.addEventListener('mousemove', (e) => {
        const x = (e.clientX / window.innerWidth) * 20;
        const y = (e.clientY / window.innerHeight) * 20;
        blobs.forEach((blob, index) => {
            const speed = (index + 1) * 2;
            blob.style.transform = `translate(${x * speed}px, ${y * speed}px)`;
        });
    });

});
</script>
</body>
</html>

