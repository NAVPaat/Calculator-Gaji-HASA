<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>HASA Dashboard</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="firebase-config.js"></script>
<script src="auth.js"></script>

<style>
/* =========================================
   1. CORE THEME
   ========================================= */
:root {
    --primary: #6C63FF;       /* Soft Purple */
    --primary-dark: #5a52d5;
    --secondary: #2DD4BF;     /* Soft Teal */
    --accent: #F472B6;        /* Soft Pink */
    --bg-body: #F3F4F6;
    --surface: #ffffff;
    --text-main: #334155;
    --text-light: #64748b;
    --danger: #ef4444;        /* Red for Logout */
    --danger-bg: #fee2e2;
    
    --shadow-card: 0 10px 30px -10px rgba(108, 99, 255, 0.15);
    --radius: 20px;
}

* { box-sizing: border-box; margin: 0; padding: 0; text-decoration: none; outline: none; }

body {
    font-family: 'Poppins', sans-serif;
    background-color: var(--bg-body);
    color: var(--text-main);
    min-height: 100vh;
    display: flex; flex-direction: column;
    overflow-x: hidden;
    opacity: 0; animation: fadeInPage 0.8s ease forwards;
}
@keyframes fadeInPage { to { opacity: 1; } }

/* =========================================
   2. BACKGROUND DECORATION
   ========================================= */
.bg-blobs {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
    background: #f8fafc;
    overflow: hidden;
}
.blob {
    position: absolute; filter: blur(80px); opacity: 0.6; z-index: -1;
    animation: floatBlob 10s infinite alternate;
}
.blob-1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: #E0E7FF; }
.blob-2 { bottom: -10%; right: -10%; width: 60vw; height: 60vw; background: #F0FDFA; }
@keyframes floatBlob { 0% { transform: translate(0,0); } 100% { transform: translate(20px, 40px); } }

/* =========================================
   3. SMART NAVBAR (AUTO HIDE & HOVER LOGOUT)
   ========================================= */
.navbar {
    display: flex; justify-content: space-between; align-items: center;
    padding: 15px 5%; margin: 20px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(12px);
    border-radius: 50px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    
    /* Logic Auto-Hide */
    position: sticky; top: 20px; z-index: 100;
    transition: transform 0.4s ease-in-out, opacity 0.4s ease-in-out;
}

/* Class untuk sorok navbar */
.navbar.nav-hidden {
    transform: translateY(-150%); /* Naik ke atas skrin */
    opacity: 0;
}

.brand {
    display: flex; align-items: center; gap: 10px;
    font-weight: 800; font-size: 1.4rem; color: var(--primary);
}
.brand img { height: 32px; }

.nav-center {
    display: flex; gap: 30px;
}
.nav-link {
    color: var(--text-light); font-weight: 600; font-size: 0.95rem;
    transition: 0.3s; position: relative;
}
.nav-link:hover, .nav-link.active { color: var(--primary); }
.nav-link.active::after {
    content:''; position: absolute; bottom:-5px; left:50%; transform:translateX(-50%);
    width: 6px; height: 6px; background: var(--primary); border-radius: 50%;
}

/* --- USER PILL (HOVER LOGOUT EFFECT) --- */
.user-pill {
    display: flex; align-items: center; gap: 12px;
    background: var(--bg-body); padding: 5px 5px 5px 20px;
    border-radius: 50px; cursor: pointer;
    transition: all 0.3s ease;
    border: 1px solid transparent;
}

.text-container {
    display: flex; flex-direction: column; align-items: flex-end;
    overflow: hidden; height: 20px; justify-content: center;
    position: relative; width: 100px; /* Fixed width supaya tak lari */
}

/* Nama User */
.user-name {
    font-weight: 600; font-size: 0.9rem; color: var(--text-main);
    transition: transform 0.3s ease, opacity 0.3s ease;
    position: absolute; right: 0;
}

/* Teks Logout (Default sembunyi) */
.logout-text {
    font-weight: 700; font-size: 0.9rem; color: var(--danger);
    position: absolute; right: 0;
    transform: translateY(20px); opacity: 0;
    transition: transform 0.3s ease, opacity 0.3s ease;
}

.avatar {
    width: 38px; height: 38px; background: var(--primary); color: white;
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    font-weight: 700; transition: 0.3s;
}

/* Hover State */
.user-pill:hover {
    background: var(--danger-bg);
    border-color: var(--danger);
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.2);
}
.user-pill:hover .user-name { transform: translateY(-20px); opacity: 0; }
.user-pill:hover .logout-text { transform: translateY(0); opacity: 1; }
.user-pill:hover .avatar { background: var(--danger); transform: scale(0.9); }

.hamburger { display: none; font-size: 1.5rem; color: var(--text-main); cursor: pointer; }

/* =========================================
   4. HERO SECTION (GREETING & CLOCK)
   ========================================= */
.container {
    max-width: 1100px; margin: 0 auto; padding: 20px; width: 100%;
}

.hero-box {
    text-align: center; margin: 40px 0 60px;
}
.greeting-main {
    font-size: 3rem; font-weight: 800; color: var(--text-main); margin-bottom: 10px;
    line-height: 1.1;
}
.highlight-text {
    background: linear-gradient(120deg, var(--primary), var(--accent));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}
.sub-greeting {
    font-size: 1.1rem; color: var(--text-light);
}

.clock-card {
    display: inline-block; margin-top: 25px;
    background: white; padding: 15px 30px; border-radius: 20px;
    box-shadow: var(--shadow-card);
    display: inline-flex; align-items: center; gap: 15px;
}
.clock-time { font-size: 2rem; font-weight: 800; color: var(--primary); font-variant-numeric: tabular-nums; }
.clock-date { font-size: 0.9rem; font-weight: 600; color: var(--text-light); text-align: left; line-height: 1.3; border-left: 2px solid #e2e8f0; padding-left: 15px; }

/* =========================================
   5. MAIN ACTION CARDS
   ========================================= */
.action-grid {
    display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 60px;
}

.card {
    background: white; border-radius: var(--radius); padding: 40px 30px;
    position: relative; overflow: hidden; transition: all 0.4s ease;
    box-shadow: var(--shadow-card); border: 2px solid transparent;
    text-align: center; cursor: pointer;
}

.card:hover {
    transform: translateY(-10px);
    border-color: var(--primary);
}

.icon-wrapper {
    width: 80px; height: 80px; margin: 0 auto 20px;
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    font-size: 2.5rem; transition: 0.4s;
}
.card-awam .icon-wrapper { background: #EEF2FF; color: var(--primary); }
.card-swasta .icon-wrapper { background: #F0FDFA; color: var(--secondary); }

.card:hover .icon-wrapper { transform: scale(1.1) rotate(5deg); }

.card h2 { font-size: 1.5rem; font-weight: 700; margin-bottom: 10px; color: var(--text-main); }
.card p { color: var(--text-light); font-size: 0.95rem; line-height: 1.6; margin-bottom: 25px; }

.btn-pill {
    display: inline-block; padding: 12px 30px; border-radius: 50px;
    font-weight: 700; font-size: 0.9rem; transition: 0.3s;
}
.card-awam .btn-pill { background: var(--primary); color: white; box-shadow: 0 4px 15px rgba(108, 99, 255, 0.4); }
.card-swasta .btn-pill { background: var(--secondary); color: white; box-shadow: 0 4px 15px rgba(45, 212, 191, 0.4); }

.card:hover .btn-pill { transform: scale(1.05); }

/* =========================================
   6. HOW-TO SECTION
   ========================================= */
.guide-section {
    background: white; border-radius: var(--radius); padding: 40px;
    box-shadow: var(--shadow-card); position: relative; overflow: hidden; margin-bottom: 50px;
}
.guide-title {
    font-size: 1.2rem; font-weight: 800; color: var(--text-main); margin-bottom: 30px;
    text-align: center; position: relative; z-index: 2;
}

.steps-grid {
    display: grid; grid-template-columns: 1fr 1fr; gap: 40px; position: relative; z-index: 2;
}
.step-col h3 { font-size: 1rem; color: var(--primary); margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
.step-list { list-style: none; }
.step-list li {
    display: flex; gap: 12px; margin-bottom: 12px; font-size: 0.9rem; color: var(--text-light);
    align-items: flex-start;
}
.step-num {
    background: #f1f5f9; color: var(--primary); font-weight: 700; font-size: 0.8rem;
    width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
}
.guide-deco {
    position: absolute; right: -20px; bottom: -20px; font-size: 8rem; opacity: 0.05; transform: rotate(-15deg);
}

/* =========================================
   7. RESPONSIVE MOBILE
   ========================================= */
@media (max-width: 800px) {
    .navbar { padding: 15px; margin: 0; border-radius: 0; top: 0; }
    
    .nav-center {
        display: none; position: absolute; top: 100%; left: 0; width: 100%;
        background: white; flex-direction: column; padding: 20px;
        box-shadow: 0 10px 20px rgba(0,0,0,0.05); gap: 15px; text-align: center;
    }
    .nav-center.active { display: flex; }
    
    /* Mobile: Hide Hover Pill, Show Hamburger */
    .user-pill { display: none; } 
    .hamburger { display: block; }
    
    .greeting-main { font-size: 2rem; }
    .action-grid { grid-template-columns: 1fr; }
    .steps-grid { grid-template-columns: 1fr; }
    .clock-card { width: 100%; justify-content: center; }
}
</style>
</head>
<body>

    <div class="bg-blobs">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
    </div>

    <nav class="navbar" id="mainNavbar">
        <div class="brand">
            <img src="image/HASA.png" alt="Logo">
            <span>HASA UiTM</span>
        </div>

        <div class="nav-center" id="navMenu">
            <a href="dashboard.html" class="nav-link active">Dashboard</a>
            <a href="contohawam.html" class="nav-link">Kiraan Awam</a>
            <a href="swasta.html" class="nav-link">Kiraan Swasta</a>
            <a href="profile.html" class="nav-link">Profile</a>
            <a href="#" id="mobileLogout" class="nav-link" style="color:#ef4444; display:none;">Log Keluar</a>
        </div>

        <div style="display:flex; align-items:center; gap:15px;">
            
            <div class="user-pill" id="logoutBtn" title="Tekan untuk Log Keluar">
                <div class="text-container">
                    <span class="user-name" id="navName">Loading...</span>
                    <span class="logout-text">Log Keluar</span>
                </div>
                <div class="avatar" id="navAvatar">?</div>
            </div>
            
            <div class="hamburger" onclick="toggleMenu()">
                <i class="fa-solid fa-bars"></i>
            </div>
        </div>
    </nav>

    <div class="container">
        
        <section class="hero-box">
            <div class="greeting-main" id="mainGreeting">
                Assalamualaikum, <br> <span class="highlight-text">...</span>
            </div>
            <p class="sub-greeting">Selamat datang ke Hab Simulasi Gaji anda.</p>

            <div class="clock-card">
                <div class="clock-time" id="clock">00:00</div>
                <div class="clock-date" id="date">Checking...</div>
            </div>
        </section>

        <div class="action-grid">
            
            <div class="card card-awam" onclick="window.location.href='contohawam.html'">
                <div class="icon-wrapper">
                    <i class="fa-solid fa-building-columns"></i>
                </div>
                <h2>Sektor Awam</h2>
                <p>Direka khas untuk penjawat awam Skim U. Kira Gaji Pokok, ITKA, ITP & BISH secara automatik mengikut pekeliling.</p>
                <div class="btn-pill">Mula Kira Sekarang <i class="fa-solid fa-arrow-right"></i></div>
            </div>

            <div class="card card-swasta" onclick="window.location.href='swasta.html'">
                <div class="icon-wrapper">
                    <i class="fa-solid fa-briefcase"></i>
                </div>
                <h2>Sektor Swasta</h2>
                <p>Simulasi untuk lantikan baru & kontrak. Sistem mengira gaji bersih setelah ditolak caruman KWSP & PERKESO.</p>
                <div class="btn-pill">Mula Kira Sekarang <i class="fa-solid fa-arrow-right"></i></div>
            </div>

        </div>

        <section class="guide-section">
            <div class="guide-title">ðŸ“– Panduan Penggunaan Sistem</div>
            
            <div class="steps-grid">
                <div class="step-col">
                    <h3><i class="fa-solid fa-building-columns"></i> Cara Kira Gaji Awam</h3>
                    <ul class="step-list">
                        <li><span class="step-num">1</span> Pilih Jawatan (Skim U) dari senarai.</li>
                        <li><span class="step-num">2</span> Pilih Wilayah Asal (Semenanjung/Sabah/Sarawak).</li>
                        <li><span class="step-num">3</span> Masukkan Gaji Pokok Semasa.</li>
                        <li><span class="step-num">4</span> Sistem akan auto-isi elaun tetap anda.</li>
                        <li><span class="step-num">5</span> Tekan "Kira" untuk lihat slip simulasi.</li>
                    </ul>
                </div>

                <div class="step-col">
                    <h3><i class="fa-solid fa-briefcase"></i> Cara Kira Gaji Swasta</h3>
                    <ul class="step-list">
                        <li><span class="step-num">1</span> Pilih Jawatan & Wilayah bertugas.</li>
                        <li><span class="step-num">2</span> Masukkan pengalaman kerja (Tahun/Bulan).</li>
                        <li><span class="step-num">3</span> Sistem mengira gaji permulaan baru.</li>
                        <li><span class="step-num">4</span> Potongan KWSP (11%) dikira automatik.</li>
                        <li><span class="step-num">5</span> Semak Gaji Bersih (Take Home Pay).</li>
                    </ul>
                </div>
            </div>
            <div class="guide-deco"><i class="fa-regular fa-lightbulb"></i></div>
        </section>

    </div>

<script>
    // ===================================
    // 1. MOBILE MENU LOGIC
    // ===================================
    function toggleMenu() {
        const menu = document.getElementById('navMenu');
        const logoutMobile = document.getElementById('mobileLogout');
        menu.classList.toggle('active');
        if(window.innerWidth <= 800) {
            logoutMobile.style.display = 'block';
        }
    }

    // ===================================
    // 2. AUTO HIDE NAVBAR ON SCROLL
    // ===================================
    let lastScrollTop = 0;
    const navbar = document.getElementById('mainNavbar');

    window.addEventListener('scroll', function() {
        let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        
        if (scrollTop > lastScrollTop && scrollTop > 50) {
            // Scroll Ke Bawah -> Sembunyi
            navbar.classList.add('nav-hidden');
        } else {
            // Scroll Ke Atas -> Tunjuk
            navbar.classList.remove('nav-hidden');
        }
        lastScrollTop = scrollTop;
    });

    // ===================================
    // 3. CLOCK & GREETING LOGIC
    // ===================================
    function updateSystem() {
        const now = new Date();
        
        // Clock
        const time = now.toLocaleTimeString('en-US', { hour12: true, hour: '2-digit', minute:'2-digit' });
        document.getElementById('clock').innerText = time;

        // Date
        const options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
        document.getElementById('date').innerText = now.toLocaleDateString('ms-MY', options);

        // Greeting Logic
        const h = now.getHours();
        let salam = "Salam Sejahtera";
        
        if (h >= 5 && h < 12) { salam = "Assalamualaikum & Selamat Pagi"; }
        else if (h >= 12 && h < 14) { salam = "Selamat Tengahari"; }
        else if (h >= 14 && h < 19) { salam = "Selamat Petang"; }
        else { salam = "Selamat Malam"; }

        window.currentSalam = salam;
    }
    setInterval(updateSystem, 1000);
    updateSystem();

    // ===================================
    // 4. FIREBASE USER DATA
    // ===================================
    onAuthChange(async user => {
        if(!user){ location.href='login.html'; return; }

        try {
            const { data } = await getCurrentUserDoc();
            const fullname = data?.fullname || user.email.split('@')[0];
            const firstName = fullname.split(' ')[0];

            // Update Greeting UI
            const finalGreet = `${window.currentSalam}, <br><span class="highlight-text">${fullname}</span>!`;
            document.getElementById('mainGreeting').innerHTML = finalGreet;
            
            // Update Navbar Pill
            
            document.getElementById('navName').innerText = firstName;
            document.getElementById('navAvatar').innerText = firstName.charAt(0).toUpperCase();

        } catch(e) { console.error(e); }
    });

    // ===================================
    // 5. LOGOUT LOGIC
    // ===================================
    const handleLogout = async (e) => {
        e.preventDefault();
        if(confirm('Anda pasti ingin log keluar?')) {
            await firebase.auth().signOut();
            window.location.href = 'login.html';
        }
    };

    document.getElementById('logoutBtn').addEventListener('click', handleLogout);
    document.getElementById('mobileLogout').addEventListener('click', handleLogout);

</script>
</body>
</html>
