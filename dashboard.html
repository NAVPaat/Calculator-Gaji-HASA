<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dashboard â€” HASA UiTM</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="firebase-config.js"></script>
<script src="auth.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* =========================================
   PAGE TRANSITION STYLES
   ========================================= */
body {
    opacity: 0; /* Mula-mula page halimunan */
    transition: opacity 0.5s ease-in-out; /* Tempoh peralihan 0.5 saat */
    pointer-events: none; /* Halang klik masa tengah loading */
}

body.loaded {
    opacity: 1; /* Muncul sepenuhnya */
    pointer-events: auto; /* Boleh klik semula */
}
/* ===== THEME VARIABLES ===== */
:root {
    --bg-main: #f8fafc;
    --bg-card: #ffffff;
    --text-primary: #0f172a;
    --text-secondary: #64748b;
    --brand-blue: #4f46e5;
    --brand-green: #10b981;
    --border-light: #e2e8f0;
    --shadow-sm: 0 1px 3px 0 rgb(0 0 0 / 0.1);
    --shadow-md: 0 10px 15px -3px rgb(0 0 0 / 0.1);
}

* { box-sizing: border-box; }

body {
    margin: 0;
    padding: 0;
    font-family: 'Inter', sans-serif;
    background-color: var(--bg-main);
    color: var(--text-primary);
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
    /* Added for smooth transition logic */
    opacity: 0; 
    transition: opacity 0.5s ease-in-out;
}

/* Class to trigger fade in when loaded */
body.loaded { opacity: 1; }

/* =========================================
   FULL PAGE MODERN BACKGROUND
   ========================================= */
.animated-bg {
    position: fixed; /* Guna fixed supaya ia kekal penuh walaupun scroll */
    top: 0; 
    left: 0; 
    width: 100%;
    height: 100%; /* Penuh satu skrin */
    
    /* Warna Moden Mesh Gradient */
    background-color: #f3f4f6;
    background-image: 
        radial-gradient(at 0% 0%, hsla(253,16%,7%,0) 0, transparent 50%), 
        radial-gradient(at 50% 0%, hsla(225,39%,30%,0) 0, transparent 50%), 
        radial-gradient(at 100% 0%, hsla(339,49%,30%,0) 0, transparent 50%);
        
    background-image: 
        radial-gradient(at 40% 20%, hsla(28,100%,74%,1) 0px, transparent 50%),
        radial-gradient(at 80% 0%, hsla(189,100%,56%,1) 0px, transparent 50%),
        radial-gradient(at 0% 50%, hsla(355,100%,93%,1) 0px, transparent 50%),
        radial-gradient(at 80% 50%, hsla(340,100%,76%,1) 0px, transparent 50%),
        radial-gradient(at 0% 100%, hsla(22,100%,77%,1) 0px, transparent 50%),
        radial-gradient(at 80% 100%, hsla(242,100%,70%,1) 0px, transparent 50%),
        radial-gradient(at 0% 0%, hsla(343,100%,76%,1) 0px, transparent 50%);

    /* Blur & Filter untuk efek lembut */
    filter: blur(60px); 
    opacity: 0.6; /* Transparansi supaya tak ganggu teks */
    z-index: -1;
    
    /* Animasi Pergerakan */
    background-size: 150% 150%;
    animation: gradientFull 15s ease infinite alternate;
}

@keyframes gradientFull {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* ===== LAYOUT ===== */
.container { max-width: 1200px; margin: 0 auto; padding: 20px; }
.grid-2 { display: grid; grid-template-columns: 280px 1fr; gap: 24px; }
@media (max-width: 900px) { .grid-2 { grid-template-columns: 1fr; } }

/* ===== CARDS ===== */
.card, .fx-card {
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: 16px;
    padding: 24px;
    box-shadow: var(--shadow-sm);
    transition: all 0.3s ease;
}
.card:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }

/* ===== TYPOGRAPHY ===== */
h2 { font-size: 1.8rem; margin: 0 0 10px 0; font-weight: 800; }
h3 { font-size: 1.2rem; margin: 0 0 10px 0; }
h4 { font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-secondary); margin: 0 0 15px 0; font-weight: 700; }
p, .small { color: var(--text-secondary); line-height: 1.6; }

/* ===== NAVBAR (UPDATED FOR BURGER & TOOLTIP) ===== */
.dashboard-nav {
    display: flex; justify-content: space-between; align-items: center;
    padding: 15px 30px;
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(12px); 
    border-bottom: 1px solid rgba(255,255,255,0.5);
    position: sticky; top: 0; z-index: 100;
    /* TAMBAH 2 BARIS INI UNTUK SMOOTH */
    transition: transform 0.3s ease-in-out;
    will-change: transform;
}

/* TAMBAH CLASS BARU INI (Untuk sorok navbar) */
.dashboard-nav.nav-hidden {
    transform: translateY(-100%); /* Tarik navbar ke atas sampai hilang */
}

.nav-left { display: flex; align-items: center; gap: 12px; }
.nav-logo { height: 48px; }
.nav-title { font-weight: 800; font-size: 1.5rem; color: #1e293b; }

.nav-right { display: flex; gap: 20px; align-items: center; }
.nav-link { text-decoration: none; color: #475569; font-weight: 600; font-size: 0.9rem; transition: 0.2s; position: relative; }
.nav-link:hover, .nav-link.active { color: var(--brand-blue); }

.hamburger { display: none; cursor: pointer; flex-direction: column; gap: 5px; }
.hamburger span { width: 25px; height: 3px; background-color: #0f172a; border-radius: 2px; transition: 0.3s; }

/* === TOOLTIP STYLES (NEW) === */
[data-tooltip]:hover::after {
    content: attr(data-tooltip);
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    margin-top: 10px;
    padding: 6px 10px;
    background-color: #1e293b;
    color: #fff;
    font-size: 0.75rem;
    border-radius: 6px;
    white-space: nowrap;
    opacity: 0;
    animation: tooltipFade 0.3s forwards;
    pointer-events: none;
    z-index: 200;
}
[data-tooltip]:hover::before { /* Arrow for tooltip */
    content: '';
    position: absolute;
    top: 100%; left: 50%;
    transform: translateX(-50%);
    margin-top: 5px;
    border-width: 5px;
    border-style: solid;
    border-color: transparent transparent #1e293b transparent;
    opacity: 0;
    animation: tooltipFade 0.3s forwards;
}
@keyframes tooltipFade { to { opacity: 1; } }

/* GANTI BAHAGIAN INI SAHAJA DALAM <style> */
@media (max-width: 768px) {
    .dashboard-nav { padding: 15px 20px; }
    .nav-title { font-size: 0.95rem; }
    .hamburger { display: flex; }
    
    .nav-right {
        /* Tukar display:none kepada display:flex supaya boleh animate */
        display: flex; 
        flex-direction: column;
        position: absolute; 
        top: 100%; 
        left: 0; 
        width: 100%;
        background: white; 
        box-shadow: 0 10px 15px rgba(0,0,0,0.1);
        align-items: stretch; 
        text-align: center;
        
        /* === SETUP ANIMASI === */
        max-height: 0;       /* Mula-mula tinggi 0 (tutup) */
        opacity: 0;          /* Halimunan */
        overflow: hidden;    /* Sorok isi dalam */
        padding: 0;          /* Padam padding supaya takde gap */
        border-bottom: none; /* Sorok border */
        
        /* Kelajuan Animasi */
        transition: all 0.4s ease-in-out;
    }

    .nav-right.active {
        /* === BILA MENU BUKA === */
        max-height: 500px;   /* Bagi ruang cukup besar */
        opacity: 1;          /* Muncul */
        padding: 20px;       /* Masukkan balik padding asal */
        border-bottom: 1px solid var(--border-light);
        gap: 15px;           /* Jarak antara item */
    }

    .nav-link { padding: 10px; border-radius: 8px; }
    .nav-link:hover { background: #f1f5f9; }
    
    /* Sembunyikan tooltip di mobile */
    [data-tooltip]:hover::after, [data-tooltip]:hover::before { display: none; }
}

/* ===== BUTTONS ===== */
.btn-outline {
    display: inline-block;
    border: 2px solid var(--border-light);
    color: var(--text-primary);
    padding: 10px 20px;
    border-radius: 10px;
    text-decoration: none;
    font-size: 13px; font-weight: 700;
    transition: all 0.2s; background: white; text-align: center;
}
.btn-outline:hover {
    border-color: var(--brand-blue); color: var(--brand-blue);
    background: #f8fafc; transform: translateY(-2px);
}
.logout-btn {
    background: #fee2e2; color: #ef4444; border: none; padding: 8px 16px; border-radius: 8px; font-weight: 700; cursor: pointer; transition: 0.2s; position: relative;
}
.logout-btn:hover { background: #fecaca; }

/* ===== INTERACTIVE STATS ===== */
.fx-summary { display: flex; gap: 24px; margin-bottom: 30px; }
.fx-stats { flex: 1; display: flex; flex-direction: column; gap: 20px; }
.fx-chart { flex: 1.2; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; min-height: 260px; background: rgba(255,255,255,0.9); }

.fx-card {
    flex: 1; display: flex; flex-direction: column; justify-content: center; cursor: pointer;
    background: rgba(255,255,255,0.9);
}
.fx-card.awam { border-left: 5px solid var(--brand-blue); }
.fx-card.swasta { border-left: 5px solid var(--brand-green); }

.fx-card:hover { transform: scale(1.02); }
.fx-card.active-filter { background: #f1f5f9 !important; border-color: transparent; }

.fx-value { font-size: 2.8rem; font-weight: 800; color: var(--text-primary); line-height: 1; }
.fx-label { font-size: 0.8rem; font-weight: 700; color: var(--text-secondary); letter-spacing: 1px; }

#payslipChartTop { width: 100%; max-height: 200px; }
.fx-chart-title { position: absolute; top: 20px; left: 24px; font-weight: 800; color: var(--text-secondary); font-size: 0.8rem; }
#resetFilterBtn {
    position: absolute; top: 15px; right: 20px; padding: 5px 12px; background: var(--brand-blue); color: white;
    border: none; border-radius: 20px; font-size: 0.7rem; font-weight: 700; cursor: pointer; display: none;
}

@media (max-width: 800px) { .fx-summary { flex-direction: column; } .fx-stats { flex-direction: row; } }
@media (max-width: 600px) { .fx-stats { flex-direction: column; } }

/* ===== OTHER ===== */
.stat-number { font-size: 3rem; font-weight: 800; color: var(--text-primary); }
.kv { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border-light); font-size: 0.9rem; }
#goTopBtn { display: none; position: fixed; bottom: 30px; right: 30px; width: 45px; height: 45px; background: var(--brand-blue); color: white; border: none; border-radius: 50%; font-size: 20px; cursor: pointer; box-shadow: var(--shadow-md); z-index: 99; }

/* Custom Footer */
.custom-footer { text-align:center; color: var(--text-secondary); padding:40px 20px; font-size:0.9rem; margin-top: 40px; }
</style>
</head>
<body> <div class="animated-bg"></div>

<nav class="dashboard-nav">
    <div class="nav-left">
        <img src="image/HASA.png" class="nav-logo" alt="Logo">
        <span class="nav-title">DASHBOARD KIRAAN GAJI</span>
    </div>
    
    <div class="hamburger" id="hamburgerBtn">
        <span></span><span></span><span></span>
    </div>

    <div class="nav-right" id="navMenu">
        <a href="dashboard.html" class="nav-link active" data-tooltip="Paparan Utama">Dashboard</a>
        <a href="contohawam.html" class="nav-link" data-tooltip="Kiraan Sektor Kerajaan">Kiraan Awam</a>        
        <a href="swasta.html" class="nav-link" data-tooltip="Kiraan Sektor Korporat">Kiraan Swasta</a>
        <button id="logoutBtn" class="logout-btn" data-tooltip="Keluar Sistem">Logout</button>
    </div>
</nav>

<div class="container">
    <div id="topPayslipSummary" class="fx-summary">
      <div class="fx-stats">
        <div class="fx-card awam" id="cardAwam">
          <div class="fx-label">CETAKAN AWAM</div>
          <div class="fx-value" id="awamCountTop">0</div>
          <div class="fx-sub">Sektor Kerajaan</div>
        </div>

        <div class="fx-card swasta" id="cardSwasta">
          <div class="fx-label">CETAKAN SWASTA</div>
          <div class="fx-value" id="swastaCountTop">0</div>
          <div class="fx-sub">Sektor Korporat</div>
        </div>
      </div>

      <div class="fx-chart card">
        <div class="fx-chart-title">AGIHAN CETAKAN</div>
        <button id="resetFilterBtn">â†» Reset</button>
        <canvas id="payslipChartTop"></canvas>
      </div>
    </div>

    <div class="grid-2">
        <div class="side">
            <div class="card">
                <h3 id="userName">Memuatkan...</h3>
                <div class="small" id="userEmail">...</div>
                <div style="height:20px"></div>
                <div class="kv"><div>Peranan</div><div id="userRole">-</div></div>
                <div class="kv"><div>Daftar</div><div id="userCreated">-</div></div>

                <div style="height:25px"></div>
                <a class="btn-outline" href="profile.html" style="width:100%; margin-bottom:10px;">EDIT PROFILE</a>
                <button id="sideLogoutBtn" class="btn-outline" style="width:100%; border-color: #fee2e2; color: #ef4444; background: #fff1f2;">LOGOUT</button>
            </div>
        </div>

        <div class="main-panel">
            <div class="card" style="border:none; background:transparent; box-shadow:none; padding:0; margin-bottom: 20px;">
                <h2 style="color:#1e293b;">Selamat Datang</h2>
                <p class="small" style="font-size:1rem; color:#475569;">Papan pemuka utama untuk mengurus dan memantau rekod kiraan gaji.</p>
            </div>

            <div class="card">
                <h4>Pautan Pantas</h4>
                <div style="display:flex; gap:12px; flex-wrap:wrap;">
                    <a class="btn-outline nav-link" href="contohawam.html" style="border-color: var(--brand-blue); color: var(--brand-blue);" data-tooltip="Ke Kiraan Awam">ðŸ–© Kiraan Awam</a>
                    <a class="btn-outline nav-link" href="swasta.html" style="border-color: var(--brand-green); color: var(--brand-green);" data-tooltip="Ke Kiraan Swasta">ðŸ–© Kiraan Swasta</a>
                </div>
            </div>

            <div style="height:24px"></div>

            <div id="payslipStats" class="card">
                <h4>Statistik Keseluruhan</h4>
                <div style="text-align: center; padding: 20px 0;">
                    <div class="stat-number" id="payslipCount">â€”</div>
                    <div style="font-size: 1.1rem; color:var(--text-secondary); margin-top:10px;">Jumlah Cetakan Slip Gaji</div>
                </div>
                <div style="border-top: 1px solid var(--border-light); padding-top: 15px; text-align: center;">
                    <div id="payslipDebug" class="small" style="opacity:0.6; font-size:0.8rem">Menunggu data...</div>
                </div>
            </div>

            <div style="height:24px"></div>

            <div id="moreArea" class="card">
                <h4>Maklumat Akaun</h4>
                <div id="accountData" class="small" style="line-height:1.8;"></div>
            </div> 
        </div>
    </div>
</div>

<footer class="custom-footer">
    Â© 2025 HASA UiTM â€” Sistem Kiraan Gaji Kakitangan
</footer>

<button id="goTopBtn" title="Go to Top">â†‘</button>

<script>
/* ========================
   PAGE TRANSITION & BURGER LOGIC
   ======================== */
document.addEventListener("DOMContentLoaded", () => {
    // Trigger smooth fade in on load
    document.body.classList.add('loaded');

    // Burger Menu
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const navMenu = document.getElementById('navMenu');
    
    if(hamburgerBtn && navMenu) {
        hamburgerBtn.addEventListener('click', () => {
            navMenu.classList.toggle('active');
        });
    }

    // Go Top Button
    const btn = document.getElementById("goTopBtn");
    window.onscroll = () => { btn.style.display = window.scrollY > 300 ? "block" : "none"; };
    btn.onclick = () => window.scrollTo({ top: 0, behavior: 'smooth' });

    // Smooth Transition Logic for Navigation Links
    const navLinks = document.querySelectorAll('.nav-link');
    navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            const targetUrl = link.getAttribute('href');
            // Check if it's a valid internal link and not just '#'
            if(targetUrl && targetUrl !== '#' && !targetUrl.startsWith('javascript')) {
                e.preventDefault(); // Stop immediate jump
                
                // Fade out effect
                document.body.style.opacity = 0;
                
                // Wait for transition (500ms matching CSS) then go
                setTimeout(() => {
                    window.location.href = targetUrl;
                }, 500);
            }
        });
    });
});

/* ========================
   LOGOUT LOGIC
   ======================== */
function setupLogout(buttonId){
  const btn = document.getElementById(buttonId);
  if(!btn) return;
  btn.addEventListener('click', async () => {
    try {
      const notif = document.createElement('div');
      notif.textContent = 'Sedang Log Keluar...';
      notif.style.cssText = "position:fixed; top:30px; left:50%; transform:translateX(-50%); background: #0f172a; color:white; padding:12px 25px; border-radius:50px; font-weight:600; box-shadow: 0 10px 20px rgba(0,0,0,0.2); z-index:9999;";
      document.body.appendChild(notif);
      
      // Visual fade out for logout too
      document.body.style.opacity = 0;

      setTimeout(async () => {
        await firebase.auth().signOut();
        location.href = 'login.html';
      }, 1500);
    } catch (e) { alert('Logout gagal.'); }
  });
}
setupLogout('logoutBtn');
setupLogout('sideLogoutBtn');

/* ========================
   AUTH CHANGE
   ======================== */
onAuthChange(async user => {
    if(!user){ location.href='login.html'; return; }
    const { uid, data } = await getCurrentUserDoc();

    document.getElementById('userName').textContent = data?.fullname || user.email.split('@')[0];
    document.getElementById('userEmail').textContent = user.email;
    document.getElementById('userCreated').textContent = data?.createdAt ? new Date(data.createdAt.seconds*1000).toLocaleDateString('en-GB') : '-';

    let role = user.email.endsWith('@uitm.edu.my') ? 'Pentadbir' : 'Pengguna';
    document.getElementById('userRole').textContent = role;

    document.getElementById('accountData').innerHTML = `
        <div style="display:flex; border-bottom:1px solid #eee; padding:8px 0;"><strong style="width:100px">Nama:</strong> ${data?.fullname || '-'}</div>
        <div style="display:flex; border-bottom:1px solid #eee; padding:8px 0;"><strong style="width:100px">Telefon:</strong> ${data?.phone || '-'}</div>
        <div style="display:flex; border-bottom:1px solid #eee; padding:8px 0;"><strong style="width:100px">Email:</strong> ${data?.email || '-'}</div>
    `;

    if(typeof updatePayslipStats === 'function') updatePayslipStats();
});

/* ========================
   STATS & CHART LOGIC
   ======================== */
let _payslipUnsub = null;
let payslipChart = null; 

async function updatePayslipStats(){
    const el = document.getElementById('payslipCount');
    const debugEl = document.getElementById('payslipDebug');
    if(!el) return; el.textContent = '...';

    const db = firebase.firestore();
    const updateUI = (total, awam, swasta) => {
        el.textContent = total;
        animateCount(document.getElementById('awamCountTop'), awam || 0);
        animateCount(document.getElementById('swastaCountTop'), swasta || 0);
        renderPayslipChart(Number(awam) || 0, Number(swasta) || 0);
        if(debugEl) debugEl.textContent = `Kemaskini terakhir: ${new Date().toLocaleTimeString()}`;
    };

    const candidateColls = ['printedSlips','prints','print_logs'];
    let found = false;

    for(const coll of candidateColls){
        try {
            const snap = await db.collection(coll).limit(1).get();
            if(!snap.empty){
                found = true;
                _payslipUnsub = db.collection(coll).onSnapshot(s => {
                    let c = {awam:0, swasta:0};
                    s.forEach(d => {
                        const t = (d.data().jenis_kiraan || '').toLowerCase();
                        if(t.includes('awam')) c.awam++;
                        else if(t.includes('swasta')) c.swasta++;
                    });
                    updateUI(s.size, c.awam, c.swasta);
                });
                break;
            }
        } catch(e){}
    }
    if(!found) { updateUI(0, 0, 0); if(debugEl) debugEl.textContent = 'Tiada data cetakan.'; }
}

function renderPayslipChart(a, b){
    const canvas = document.getElementById('payslipChartTop');
    if(!canvas) return;
    const ctx = canvas.getContext('2d');
    const total = a + b;

    const centerTextPlugin = {
        id: 'centerText',
        afterDraw(chart) {
            const { ctx, chartArea } = chart;
            if (!chartArea) return;
            const x = (chartArea.left + chartArea.right) / 2;
            const y = (chartArea.top + chartArea.bottom) / 2;
            
            ctx.save();
            ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
            ctx.font = '800 24px Inter'; ctx.fillStyle = '#0f172a';
            ctx.fillText(chart.centerValue !== undefined ? chart.centerValue : total, x, y - 5);
            ctx.font = '600 12px Inter'; ctx.fillStyle = '#64748b';
            ctx.fillText(chart.centerLabel || 'Jumlah', x, y + 15);
            ctx.restore();
        }
    };

    if(payslipChart){
        payslipChart.data.datasets[0].data = [a, b];
        payslipChart.update();
        if(!canvas.dataset.init) { setupChartInteraction(payslipChart, a, b); canvas.dataset.init = true; }
        return;
    }

    payslipChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Awam', 'Swasta'],
            datasets: [{
                data: [a, b],
                backgroundColor: ['#4f46e5', '#10b981'],
                borderWidth: 2, borderColor: '#ffffff',
                hoverOffset: 10, borderRadius: 5
            }]
        },
        options: {
            cutout: '75%', responsive: true, maintainAspectRatio: false,
            plugins: { legend: { display: false }, tooltip: { backgroundColor: '#1e293b', padding: 12, cornerRadius: 8 } }
        },
        plugins: [centerTextPlugin]
    });
    setupChartInteraction(payslipChart, a, b);
    canvas.dataset.init = true;
}

function setupChartInteraction(chart, awamTotal, swastaTotal) {
    const cardAwam = document.getElementById('cardAwam');
    const cardSwasta = document.getElementById('cardSwasta');
    const resetBtn = document.getElementById('resetFilterBtn');
    const dataset = chart.data.datasets[0];

    const applyFilter = (type) => {
        resetBtn.style.display = 'block';
        cardAwam.classList.remove('active-filter');
        cardSwasta.classList.remove('active-filter');
        if (type === 'awam') {
            cardAwam.classList.add('active-filter');
            dataset.backgroundColor = ['#4f46e5', '#e2e8f0']; 
            chart.centerValue = awamTotal; chart.centerLabel = 'Awam';
        } else {
            cardSwasta.classList.add('active-filter');
            dataset.backgroundColor = ['#e2e8f0', '#10b981'];
            chart.centerValue = swastaTotal; chart.centerLabel = 'Swasta';
        }
        chart.update();
    };

    resetBtn.onclick = () => {
        resetBtn.style.display = 'none';
        cardAwam.classList.remove('active-filter');
        cardSwasta.classList.remove('active-filter');
        dataset.backgroundColor = ['#4f46e5', '#10b981'];
        delete chart.centerValue; chart.centerLabel = 'Jumlah';
        chart.update();
    };

    cardAwam.onclick = () => applyFilter('awam');
    cardSwasta.onclick = () => applyFilter('swasta');
}

function animateCount(el, target){
    if(!el) return;
    const duration = 1000; const startTime = performance.now();
    function tick(now){
        const p = Math.min((now - startTime)/duration, 1);
        const ease = 1 - Math.pow(1 - p, 3);
        el.textContent = Math.floor(ease * target);
        if(p < 1) requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);
}
/* =========================================
   PAGE TRANSITION LOGIC
   ========================================= */
document.addEventListener("DOMContentLoaded", () => {
    
    // 1. FADE IN (Bila page baru buka)
    // Kita bagi sedikit masa (10ms) supaya browser sempat render
    setTimeout(() => {
        document.body.classList.add("loaded");
    }, 10);

    // 2. FADE OUT (Bila klik link navigasi)
    // Cari semua link (<a>) dalam page
    const links = document.querySelectorAll('a');

    links.forEach(link => {
        link.addEventListener('click', (e) => {
            const targetUrl = link.getAttribute('href');

            // Pastikan link tu bukan link kosong (#) atau javascript
            if (targetUrl && targetUrl !== '#' && !targetUrl.startsWith('javascript')) {
                e.preventDefault(); // Halang browser buka terus
                
                // Buat animasi hilang dulu (Fade Out)
                document.body.classList.remove("loaded");

                // Tunggu 0.5 saat (sama dengan masa transition CSS), baru pergi ke page lain
                setTimeout(() => {
                    window.location.href = targetUrl;
                }, 500); 
            }
        });
    });
});
// Variable untuk simpan kedudukan scroll terakhir
let lastScrollTop = 0;
const navbar = document.querySelector('.dashboard-nav');

window.addEventListener('scroll', function() {
    let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    
    // Jangan buat apa-apa kalau scroll "bounce" kat atas sekali (Safari/Mobile)
    if(scrollTop < 0) return;

    // Logic: Kalau scroll ke bawah DAN dah lepas 50px dari atas
    if (scrollTop > lastScrollTop && scrollTop > 50) {
        // Tambah class untuk sorok
        navbar.classList.add('nav-hidden');
    } else {
        // Buang class untuk tunjuk balik (bila scroll ke atas)
        navbar.classList.remove('nav-hidden');
    }
    
    lastScrollTop = scrollTop;
});
/* =========================================
   FORCE SCROLL TO TOP ON REFRESH
   ========================================= */
if (history.scrollRestoration) {
    history.scrollRestoration = 'manual'; // Halang browser ingat position lama
}
window.scrollTo(0, 0); // Paksa naik atas serta-merta
</script>
</body>
</html>
